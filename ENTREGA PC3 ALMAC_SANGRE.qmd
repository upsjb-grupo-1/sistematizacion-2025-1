---
title: "ENTREGA PC3 ALMAC_SANGRE"
format: html
editor: visual
---

# Introducción

Este documento presenta un análisis univariado y multivariado aplicado a un conjunto de datos clínicos de pacientes con cáncer de próstata. El objetivo principal es explorar factores asociados con la **recurrencia bioquímica** posterior al tratamiento quirúrgico.

El análisis incluye una descripción individual (univariada) de cada variable, seguida por un modelo de regresión logística univariado y multivariado para identificar asociaciones significativas entre características clínicas y la variable dependiente (`Recurrencia_bioquimica`).

# Instalación y carga de paquetes

En esta sección se realiza la carga del archivo `.csv` que contiene los datos clínicos de los pacientes, seguido de una inspección general del conjunto de datos. Se revisan los nombres de las variables, su tipo, la estructura y un resumen estadístico para identificar el tipo de datos (numéricos o categóricos), valores faltantes y rangos. Esta revisión es fundamental para guiar el análisis posterior. Debemos de modificar el "TuUsuario" por el de nuestro ordenador.

```{r}
# Instalación de paquetes si no están instalados
paquetes <- c("tidyverse", "readr", "ggplot2", "dplyr", "broom")
instalar <- paquetes[!paquetes %in% installed.packages()]
if(length(instalar)) install.packages(instalar)

# Carga de paquetes
library(tidyverse)
library(readr)
library(ggplot2)
library(dplyr)
library(broom)

# Leer el archivo CSV
data <- read_csv("C:/Users/TuUsuario/Desktop/DATA/almac_sangre.csv")
```

# Exploración de la estructura de los datos

```{r}
# Estructura y nombres
str(data)
names(data)
summary(data)
```

# Conversión de variables categóricas a factor

Antes de realizar análisis estadísticos, es importante asegurarse de que las variables categóricas estén correctamente codificadas como factores.

Esta transformación permite que los modelos estadísticos y gráficos interpreten adecuadamente los niveles de cada categoría, como "Sí" y "No" o "Presente" y "Ausente". En esta sección se convierten variables relevantes como `Recurrencia_bioquimica`, `Terapia_previa`, entre otras.

```{r}

# Cargar paquetes necesarios
library(dplyr)
library(readr)

data <- data %>%
  mutate(
    Recurrencia_bioquimica = factor(Recurrencia_bioquimica, levels = c("No", "Sí")),
    Raza_afroamericana = factor(Raza_afroamericana),
    Historia_familiar = factor(Historia_familiar),
    Confinamiento_organo = factor(Confinamiento_organo),
    Terapia_previa = factor(Terapia_previa),
    Terapia_adyuvante = factor(Terapia_adyuvante),
    Radioterapia_adyuvante = factor(Radioterapia_adyuvante),
    BN_positivo = factor(BN_positivo)
  )
```

# Análisis Univariado

El análisis univariado permite describir individualmente cada variable del conjunto de datos.

Este procedimiento incluye histogramas para variables numéricas y gráficos de cajas (boxplots) para evaluar la distribución según variables categóricas.

Este paso es esencial para comprender la distribución de los datos, identificar valores atípicos y orientar el análisis bivariado y multivariado posterior.

```{r}

# Cargar la librería ggplot2
library(ggplot2)

# Histograma para Edad
ggplot(data, aes(x = Edad)) +
  geom_histogram(binwidth = 5, fill = "steelblue", color = "black") +
  labs(title = "Distribución de Edad", x = "Edad", y = "Frecuencia")

# Boxplot de PSA por Recurrencia
ggplot(data, aes(x = Recurrencia_bioquimica, y = PSA_preoperatorio)) +
  geom_boxplot(fill = "tomato") +
  labs(title = "PSA según recurrencia", x = "Recurrencia bioquímica", y = "PSA preoperatorio")
```

# Regresión Logística Univariada

La regresión logística univariada permite evaluar la asociación entre una sola variable predictora y una variable binaria dependiente.

En este caso, se estudia la relación entre el valor de PSA preoperatorio y la recurrencia bioquímica.

El modelo estima la odds ratio (OR) y su intervalo de confianza, lo que permite identificar si existe una relación significativa entre ambas variables.

```{r}
# Instalar y cargar broom si es necesario
if (!require(broom)) install.packages("broom")
library(broom)

# Modelo univariado: PSA y recurrencia
modelo_uni <- glm(Recurrencia_bioquimica ~ PSA_preoperatorio, data = data, family = binomial)

# Resumen del modelo
summary(modelo_uni)

# Coeficientes del modelo con OR y CI
tidy(modelo_uni, exponentiate = TRUE, conf.int = TRUE)
```

# Regresión Logística Multivariada

En esta sección se aplica un modelo de regresión logística multivariada para analizar el efecto conjunto de múltiples variables clínicas sobre la recurrencia bioquímica.

Este enfoque permite controlar por variables de confusión y estimar el efecto independiente de cada predictor. Se incluyen variables como edad, PSA preoperatorio, volumen prostático y antecedentes clínicos relevantes.

```{r}

# Modelo multivariado con variables seleccionadas
modelo_multi <- glm(Recurrencia_bioquimica ~ Edad + PSA_preoperatorio + Volumen_prostata + Historia_familiar + Confinamiento_organo + Terapia_previa, 
                    data = data, family = binomial)
summary(modelo_multi)
tidy(modelo_multi, exponentiate = TRUE, conf.int = TRUE)
```

# Reporte e interpretación de resultados

Finalmente, se interpreta la salida de los modelos de regresión logística (univariado y multivariado), enfocándose en la significancia estadística, las odds ratios (OR) y los intervalos de confianza.

Este análisis permite determinar qué variables tienen mayor peso o influencia en la probabilidad de recurrencia bioquímica, y qué factores podrían ser considerados clínicamente relevantes.

#### Regresión logística univariada

La odds ratio (OR) obtenida del modelo univariado para `PSA_preoperatorio` indica que **por cada unidad adicional de PSA**, las probabilidades de **recurrencia bioquímica** aumentan, si la OR es \>1 y estadísticamente significativa.

#### Regresión logística multivariada

En el modelo multivariado, se observa el efecto conjunto de varias variables clínicas.

***Por ejemplo:***

-   Si `PSA_preoperatorio` tiene una **OR \> 1**, sugiere un riesgo elevado de recurrencia.

-   Si `Confinamiento_organo` tiene una **OR \< 1**, podría ser un **factor protector**.

-   Se deben considerar los intervalos de confianza y valores p para determinar significancia.
