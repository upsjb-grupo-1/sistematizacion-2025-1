---
title: "ENTREGA PC4 ALMAC_SANGRE"
format: html
editor: visual
---

# Introducción:

-   El cáncer de próstata es una enfermedad heterogénea, con pacientes que presentan perfiles clínicos y evoluciones muy distintas. Identificar grupos de pacientes con características similares permite personalizar tratamientos y seguimientos.

-   El análisis de conglomerados (clustering) es una técnica de machine learning no supervisado que permite agrupar observaciones en grupos homogéneos. Aplicar clustering a datos clínicos puede revelar patrones ocultos útiles para la práctica médica.

-   En este análisis, se empleará clustering sobre el conjunto de datos almacenado en **almac_sangre.csv**, compuesto por información clínica, patológica y de seguimiento de 316 pacientes.

# Carga de paquetes y dataset: 

```{r}
# Instalación (solo si no están instalados)
install.packages("tidyverse")
install.packages("cluster")
install.packages("factoextra")
install.packages("dplyr")

# Carga de librerías
library(tidyverse)
library(cluster)
library(factoextra)
library(dplyr)

# Leer el archivo CSV
data <- read_csv("C:/Users/Franco Rodrigo/Desktop/DATA/almac_sangre.csv")
```

# Verificamos la estructura del dataset: 

```{r}
# Estructura y nombres
str(data)
names(data)
summary(data)
```

# Documentación de la Aplicación del Análisis de Conglomerados: 

Leemos el archivo `almac_sangre.csv`:

```{r}
# Visualizar estructura
str(data)

# Resumen estadístico
summary(data)
```

#### **Paso 2: Selección de variables**

Para el análisis inicial, seleccionamos variables numéricas, porque el algoritmo K-means requiere datos cuantitativos. Posteriormente se podrían integrar variables categóricas mediante métodos específicos **(e.g. Gower).**

**Seleccionamos:**

-   Edad

-   Volumen_prostata

-   PSA_preoperatorio

-   Unidades_transfundidas

-   Tiempo_hasta_recurrencia

**Se eliminan filas con valores NA en estas variables:**

```{r}
# Selección de columnas

data_numeric <- data[, c("Edad", "Volumen_prostata", "PSA_preoperatorio",
                         "Unidades_transfundidas", "Tiempo_hasta_recurrencia")]

# Eliminación de filas con NA

data_numeric <- na.omit(data_numeric)
```

#### **Paso 3: Escalado de variables**

Es necesario escalar las variables para que tengan la misma unidad de medida:

```{r}
# Escalado
data_scaled <- scale(data_numeric)
```

#### **Paso 4: Determinación del número óptimo de clusters**

Usamos métodos gráficos para decidir el número óptimo de clusters:

```{r}

# instalamos y cargamos paquetes necesarios:

install.packages("factoextra")
library(factoextra)

# Método del codo

fviz_nbclust(data_scaled, kmeans, method = "wss")

# Método de la silueta

fviz_nbclust(data_scaled, kmeans, method = "silhouette")
```

#### **Paso 5: Aplicación de K-means**

Aplicamos el algoritmo con 3 clusters:

```{r}
# K-means
set.seed(123)
km_result <- kmeans(data_scaled, centers = 3, nstart = 25)

# Añadimos el cluster al dataset original
data_clusters <- data_numeric %>%
  mutate(Cluster = as.factor(km_result$cluster))
```

# Paso 6: Visualización de clusters

Podemos visualizar los clusters en dos dimensiones con PCA:

```{r}
# Visualización
fviz_cluster(km_result, data = data_scaled,
             geom = "point", ellipse.type = "convex",
             palette = "jco", ggtheme = theme_minimal())
```

#### **Paso 7: Caracterización de clusters**

Calculamos medias de las variables numéricas por grupo:

```{r}
data_clusters %>%
  group_by(Cluster) %>%
  summarise(across(everything(), mean, na.rm = TRUE))
```

# Documentación de la Interpretación de Resultados

El análisis de conglomerados sobre **almac_sangre.csv** revela que los pacientes pueden agruparse en distintos perfiles basados en variables clínicas cuantitativas. Esto podría traducirse en distintos riesgos de progresión, complicaciones o recurrencia del cáncer de próstata.

-   Se detectan patrones objetivos de segmentación.

-   Esto facilita la personalización del seguimiento médico.

-   Futuros análisis pueden incluir las variables categóricas (e.g. Gleason, Volumen_tumoral) usando métodos como clustering jerárquico con distancia de Gower.

Este análisis es un primer paso para clasificar pacientes en perfiles clínicos útiles para la práctica médica.
